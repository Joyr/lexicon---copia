<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <title>{{title}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/main.css" rel="stylesheet" type="text/css"/>  
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
    
    <!--   - tagThat's base CSS (tagThat.css). -->
    <link href="css/tagThat.css" rel="stylesheet" type="text/css">
    <link rel="icon" type="image/png" href="http://lexicon.on-lingua.org/favicon.png" />
    
    <!-- jQuery -->
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    
    <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
    
    <!-- Other plug-ins & useful tools -->
    <script src="js/util.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/tagThat.js"></script>
    
    <!--EXPIRE-->
    
<!-- Other options 

-->      
</head>
<body>
<div data-role="page">
    <div data-role="header">
    	<a data-role="button" data-rel="back" data-icon="back" data-transition="flip">__Back__</a>
		<h1>LEXICON</h1>           	
    </div>
    <div data-role="content" id="login">
    	<div>
        	<form data-ajax="false">
            <ul data-role="listview"  data-inset="true">
            	<li data-role="list-divider">__Register__</li>
                <li>__User__ <input type="text" name="username" maxlength="20" data-mini="true" data-clear-btn="true"/></li>
                <li>__Password__ <input type="password" name="password" maxlength="20" data-mini="true" data-clear-btn="true"/>
                    <div id='password-secure'><span id="level1"></span><span id="level-char"></span></div>
                </li>
                <li>__Repeat-Password__ <input type="password" name="password2" maxlength="20" data-mini="true" data-clear-btn="true"/></li>
                <li>__e-mail__ <input type="text" name="email" data-mini="true" placeholder="example@example.com" data-clear-btn="true"/></li>
                <li>__Name__ <input type="text" name="name" maxlength="20" data-mini="true" data-clear-btn="true"/></li>
                <li>__Last_Name__ <input type="text" name="lastname" maxlength="20" data-mini="true" data-clear-btn="true"/></li>  
                <li><select name="options-lang" id="options-lang" data-native-menu="false" data-theme="c" data-mini="true">  
                    <option>__Language__</option>                                  
                    <!-- Language -->
                    </select>
                </li>              
                <li><button id="register">__Register__</button></li>           	
            </ul>
            </form>
        </div>
	</div>		
</div>
<!-- Dialogs & Alerts -->
<div id="alert-register"  data-role="dialog">
    	<div data-role="header">
        	<h3></h3>
        </div>
        <div data-role="content" data-iconpos="left">
	        <p></p>                    
			<a id="ok" data-role="button" data-rel="back" class="ui-btn-right">OK</a>
        </div>        
</div>
<script type="text/javascript">
    $(document).ready(function(){        
        $('input[name=password]').keyup(function(){
          largo=$(this).val().length;
          diferents=$(this).val().match(/([A-Z]+[a-z]+)|([a-z]+[A-Z]+)/g);
          digits=$(this).val().match(/\d+/g);
          if(largo==0){
                $('#level-char').html('');
          }else if(largo<5&&(diferents==null||digits==null)){
              $('#level-char').html('Poco seguro');
          }else if(digits!=null&&diferents!=null){
              $('#level-char').html('Muy seguro');
          }else if(largo<10||diferents!=null||digits!=null){
              $('#level-char').html('Medio seguro');
          }              
        });
    	$('form').submit(function(e){
    	    information = $('input').serialize();
    	    information = information.split('&');
    		e.preventDefault();		
    		$.each(information, function(index,value) {
    		    value=value.split('=');		                
                information[value[0]]=$.trim(value[1]);		  
    		});
    		error=0;
    		username_ver= information['username'].replace(/\d/gi,'');		
    		if(username_ver==''){
    		    error=1;
    		}else{
    		    
    		}
    		if(information['password']!=information['password2']||information['password']<5)
    		{
    		    error=1;
    		}else{
    		    
    		}		
    		email_ver = information['email'].split('%40');
    		$.each(email_ver, function(key,value){
    		   switch(key){
    		       case 0:
    		          if(value<3){
    		              error=1;  
    		          }else{
    		              
    		          } 
    		       break;
    		       case 1:
    		          if(value.lastIndexOf('.')==-1){
    		              error=1;   
    		          }else{
    		              
    		          }
    		       break;		         
    		   } 
    		});
    		if(error==0){    
    		      dataform=$('input').serialize()+'&language='+$('#options-lang option:selected').attr('id').replace('language-id-','');	        		    
    		    $.ajax({      
                    url:"php/register.php",
                    type:'POST',
                    data:dataform
                })
                .done(function(msg) { 
                    var val = $.parseJSON(msg);
                    $('p').html(val.msg); 
                    if(val.error==0)
                        location.href="/lexicon/";
                    else
                        $.mobile.changePage('#alert-register'); 
                })
                .fail(function(msg) { 
                    var val = jQuery.parseJSON(msg);
                    alert(val.msg); 
                });
    		}		
    	});	
    });
</script>
</body>
</html>